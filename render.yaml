services:
  - type: web
    name: taixiu-bot
    env: node
    plan: free
    buildCommand: |
      echo "ğŸ“¦ Installing system dependencies for canvas..."
      apt-get update
      apt-get install -y \
        build-essential \
        libcairo2-dev \
        libpango1.0-dev \
        libjpeg-dev \
        libgif-dev \
        librsvg2-dev \
        libpixman-1-dev \
        fonts-dejavu-core
      echo "ğŸ“¦ Installing Node.js dependencies..."
      npm install
      echo "âœ… Build complete!"
      echo "ğŸ§ª Testing Canvas module..."
      node -e "try { require('canvas'); console.log('   âœ… Canvas test: OK'); } catch(e) { console.error('   âŒ Canvas test FAILED:', e.message); }"
    startCommand: node index.js
    envVars:
      - key: TOKEN
        sync: false
      - key: NODE_ENV
        value: production
